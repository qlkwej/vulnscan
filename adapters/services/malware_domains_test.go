package services

import (
	"github.com/simplycubed/vulnscan/entities"
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestGetDatabase(t *testing.T) {
	if database, err := getDataBase(); err != nil {
		t.Error(err)
	} else {
		if len(database) < 1000 {
			t.Errorf("Database too short, check if everything is correct: %#v", database)
		}
	}
}

func TestMalwareDomainsAdapter(t *testing.T) {
	var (
		command = entities.Command{}
		entity  = entities.CodeAnalysis{Urls: []entities.UrlFinding{
			{
				Url: "luckytidy.info/some_page",
			},
			{
				Url: "inlinea.co.uk/suspended.page",
			},
			{
				Url: "sexzoznamka.eu/lightbox/js/r/files/tasks/AC",
			},
			{
				Url: "pride-u-bike.com/motorcycle/vozdeniye-motorcycle/",
			},
			{
				Url: "pokachi.net/search?pak=chi",
			},
		}}
	)
	assert.NoError(t, MalwareDomainsAdapter(command, &entity))
	assert.Equal(t, len(entity.Urls), len(entity.BadDomains))
}
